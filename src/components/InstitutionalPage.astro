---
// src/components/InstitutionalPage.astro
// Canonical layout for the Sobre Nós / Institutional page.
// Renders: Hero → Manifesto → Joint Venture → Credentials → TrustBar → Contact

import type { InstitutionalPayload } from '../types/content';
import Layout from '../layouts/Layout.astro';
import Header from './Header.astro';
import Footer from './Footer.astro';
import HeroVideo from './HeroVideo.astro';
import TrustBar from './TrustBar.astro';
import DynamicLeadForm from './DynamicLeadForm.astro';
import { resolveAsset } from '../utils/assets';

interface Props {
  page: InstitutionalPayload;
  lang: string;
  seoTitle: string;
  seoDescription?: string;
}

const { page, lang, seoTitle, seoDescription } = Astro.props;
const BASE = import.meta.env.BASE_URL;

const jvImage = page.jointVenture.evidenceImage
  ? resolveAsset(page.jointVenture.evidenceImage.src, BASE)
  : null;
---

<Layout title={seoTitle} lang={lang} description={seoDescription}>
  <Header />
  <main id={page.id}>

    <!-- HERO -->
    <HeroVideo {...page.hero} />

    <!-- MANIFESTO -->
    <section id="manifesto" class="py-24 bg-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <span class="text-blue-700 font-bold tracking-wider uppercase text-xs">Nossa Essência</span>
        <h2 class="text-3xl sm:text-4xl font-bold text-slate-900 mt-4 mb-8 leading-tight">
          {page.manifesto.title}
        </h2>
        <p class="text-lg text-slate-600 leading-relaxed max-w-3xl mx-auto border-l-4 border-blue-500 pl-6 text-left">
          {page.manifesto.body}
        </p>
        {page.manifesto.mission && (
          <div class="mt-10 inline-flex items-center gap-3 px-6 py-4 bg-blue-700 rounded-xl text-white max-w-2xl mx-auto">
            <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
            <p class="text-sm font-semibold text-left italic">{page.manifesto.mission}</p>
          </div>
        )}
      </div>
    </section>

    <!-- JOINT VENTURE -->
    <section id="joint-venture" class="py-24 bg-slate-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class={`grid gap-16 items-start ${jvImage ? 'lg:grid-cols-2' : 'lg:grid-cols-1'}`}>
          <div>
            <span class="text-blue-700 font-bold tracking-wider uppercase text-xs">Joint Venture Estratégica</span>
            <h2 class="text-3xl font-bold text-slate-900 mt-4 mb-6 leading-tight">
              {page.jointVenture.title}
            </h2>
            <p class="text-lg text-slate-600 leading-relaxed mb-8">
              {page.jointVenture.body}
            </p>
            <ul class="space-y-3">
              {page.jointVenture.capabilities.map((cap) => (
                <li class="flex items-start gap-3">
                  <span class="flex-shrink-0 w-5 h-5 rounded-full bg-blue-700 flex items-center justify-center mt-0.5">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                    </svg>
                  </span>
                  <span class="text-slate-700 font-medium">{cap}</span>
                </li>
              ))}
            </ul>
          </div>
          {jvImage && page.jointVenture.evidenceImage && (
            <figure class="overflow-hidden rounded-xl bg-slate-100 shadow-lg">
              <div class="relative aspect-video overflow-hidden">
                <img
                  src={jvImage}
                  alt={page.jointVenture.evidenceImage.alt}
                  class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
                  loading="lazy"
                  decoding="async"
                />
              </div>
              {page.jointVenture.evidenceImage.caption && (
                <figcaption class="px-4 py-3 text-xs text-slate-500 font-medium border-t border-slate-200 bg-white">
                  {page.jointVenture.evidenceImage.caption}
                </figcaption>
              )}
            </figure>
          )}
        </div>
      </div>
    </section>

    <!-- CREDENTIALS -->
    <section id="credenciais" class="py-20 bg-white">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <span class="text-blue-700 font-bold tracking-wider uppercase text-xs">Autoridade</span>
        <h2 class="text-3xl font-bold text-slate-900 mt-4 mb-8 leading-tight">
          {page.credentials.title}
        </h2>
        <ul class="space-y-4">
          {page.credentials.items.map((item) => (
            <li class="flex items-start gap-4 p-4 bg-slate-50 rounded-lg border border-slate-100 hover:border-blue-200 hover:bg-blue-50/40 transition-colors group">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-blue-700 flex items-center justify-center mt-0.5">
                <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                </svg>
              </span>
              <div class="flex-1">
                <span class="font-semibold text-slate-800 group-hover:text-blue-800 transition-colors">{item.title}</span>
                {item.codeRef && (
                  <span class="ml-2 text-xs font-mono text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded" title="Código de rastreabilidade">
                    #{item.codeRef}
                  </span>
                )}
              </div>
            </li>
          ))}
        </ul>
      </div>
    </section>

    <!-- LEAD FORM -->
    <section id="contact" class="bg-slate-900 py-20">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-10">
          <h2 class="text-3xl font-bold text-white mb-3">Entre em Contato com a Diretoria</h2>
          <p class="text-slate-400">Para projetos corporativos, joint ventures ou parcerias estratégicas.</p>
        </div>
        <DynamicLeadForm
          formId="lead-institucional"
          title=""
          submitLabel="Enviar Mensagem"
          endpoint="/api/v1/public/leads"
          hiddenIntentKey="LEAD_INSTITUCIONAL_CONTATO"
          fields={[
            { name: "name", label: "Nome", type: "text", required: true },
            { name: "company", label: "Empresa", type: "text", required: true },
            { name: "email", label: "E-mail Corporativo", type: "email", required: true },
            { name: "phone", label: "Telefone", type: "tel", required: true },
            { name: "context", label: "Assunto / Mensagem", type: "textarea", required: false }
          ]}
        />
      </div>
    </section>

    <!-- TRUST BAR -->
    <TrustBar />

  </main>
  <Footer />
</Layout>
